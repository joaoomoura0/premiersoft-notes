<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Diário de Ocorrências</title>
    <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="/css/diario/diario.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"/>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script src="/js/diario.js" defer></script>

</head>
<body>
<button class="menu-toggle" id="menu-toggle">☰</button>

<aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
        <img src="/img/premier-logo.png" alt="Logo premier">
    </div>
    <ul class="sidebar-nav">
        <li class="sidebar-nav-item"><a href="#" id="openPeriodModalBtnSidebar">Criar uma ocorrência</a></li>
        <li class="sidebar-nav-item"><a href="/">Voltar ao Home</a></li>
    </ul>
</aside>

<main class="main-content" id="main-content">
    <header>
        <img src="/img/premier-logo.png" alt="Logo premier" class="header-logo">
    </header>

    <div class="search-container">
        <input
                type="text"
                id="buscaOcorrencia"
                placeholder="Pesquisar colaborador..."
                class="form-control">
        <button onclick="buscarOcorrencias()" class="btn btn-primary">Buscar</button>
    </div>

    <div id="modalResultados" class="search-modal-overlay">
        <div class="modal-search-content">
            <span class="search-close-btn" onclick="fecharModalResultados()">&times;</span>
            <h2>Resultados da Busca</h2>
            <div id="loading" style="display:none;">
                Buscando...
            </div>
            <ul id="listaResultados"></ul>
            <div id="semResultados" style="display:none;">
                Nenhuma ocorrência encontrada.
            </div>
        </div>
    </div>


    <div th:if="${mensagemSucesso}" class="alert alert-success" role="alert">
        <p th:text="${mensagemSucesso}"></p>
    </div>

    <div th:if="${mensagemErro}" class="alert alert-danger" role="alert">
        <p th:text="${mensagemErro}"></p>
    </div>

    <div class="calendar-wrapper">
        <div class="calendar-header-container">
            <button id="prevMonth" class="btn btn-secondary nav-btn">
                <i class="fas fa-chevron-left"></i>
            </button>
            <h2 id="currentMonthYear">Mês Ano</h2>
            <button id="nextMonth" class="btn btn-secondary nav-btn">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <div class="calendar-grid-header">
            <span>Dom</span><span>Seg</span><span>Ter</span><span>Qua</span>
            <span>Qui</span><span>Sex</span><span>Sáb</span>
        </div>

        <div id="calendarGrid" class="calendar-grid"></div>
    </div>
</main>

<div id="periodOccurrenceModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-calendar-alt"></i> Registrar Ocorrência por Período</h3>
            <span class="close-btn">&times;</span>
        </div>

        <div class="modal-body">
            <form id="periodForm" th:action="@{/diario/salvar-periodo}" method="post">

                <div class="colaborador-account" style="display: flex; gap: 20px; align-items: flex-start;">
                    <div class="form-group">
                        <label for="colaboradorPeriodo"><i class="fas fa-user"></i> Colaborador:</label>
                        <select id="colaboradorPeriodo" name="colaboradorId" class="select-filtro" required>
                            <option value="">Selecione um Colaborador</option>
                            <option th:each="colab : ${colaboradores}"
                                    th:value="${colab.id}"
                                    th:text="${colab.nomeCompleto}"></option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="accountPeriodo"><i class="fas fa-user"></i> Account:</label>
                        <select id="accountPeriodo" name="account" class="select-filtro" required>
                            <option value=""> Selecione uma Account </option>
                            <option th:each="acc : ${accounts}" th:value="${acc}" th:text="${acc}"></option>
                        </select>
                    </div>
                </div>

                <div class="form-clockify" style="display: flex; align-items: flex-end; gap: 16px;">
                    <div class="form-group">
                        <label for="origemTipoPeriodo"><i class="fas fa-building"></i> Origem:</label>
                        <select id="origemTipoPeriodo" name="origemTipo" class="select-filtro" required>
                            <option value=""> Selecione a Origem </option>
                            <option value="TimeTracker">TimeTracker</option>
                            <option value="Clockify">Clockify</option>
                        </select>
                    </div>

                    <div class="form-group" id="clockifyClientesPeriodoContainer" style="flex: 1; display: none;">
                        <label for="clockifyClientePeriodo"><i class="fas fa-building"></i> Cliente Clockify:</label>
                        <select id="clockifyClientePeriodo" name="clockifyCliente" class="select-filtro">
                            <option value=""> Selecione o Cliente </option>
                            <option value="AB-InBev">AB-InBev</option>
                            <option value="Cheesecake Labs">Cheesecake Labs</option>
                            <option value="COAMO">COAMO</option>
                            <option value="Contabilizei">Contabilizei</option>
                            <option value="Credisis">Credisis</option>
                            <option value="Grupo Potencial">Grupo Potencial</option>
                            <option value="Iconic Hearts">Iconic Hearts</option>
                            <option value="Philips">Philips</option>
                            <option value="Serasa">Serasa</option>
                            <option value="Sicoob SC/RS">Sicoob SC/RS</option>
                            <option value="Studio Z">Studio Z</option>
                            <option value="Tonic.ai">Tonic.ai</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="tipoPeriodo"><i class="fas fa-tag"></i> Tipo:</label>
                    <select id="tipoPeriodo" name="tipo" class="select-filtro" required>
                        <option value="">Selecione o Tipo</option>
                        <option th:each="t : ${tipos}"
                                th:value="${t}"
                                th:text="${t.descricao}"></option>
                    </select>
                </div>

                <div class="form-dates" style="display: flex; gap: 20px;">
                    <div class="form-group">
                        <label for="dataInicio"><i class="fas fa-calendar-alt"></i> Data de Início:</label>
                        <input type="date" id="dataInicio" name="dataInicio" required>
                    </div>

                    <div class="form-group">
                        <label for="dataFim"><i class="fas fa-calendar-alt"></i> Data de Fim:</label>
                        <input type="date" id="dataFim" name="dataFim" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="statusPeriodo"><i class="fas fa-flag"></i> Status Padrão:</label>
                    <select id="statusPeriodo" name="status" class="select-filtro" required>
                        <option value="">Selecione o Status</option>
                        <option th:each="s : ${statusValues}" th:value="${s}" th:text="${s}"></option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="descricaoPeriodo"><i class="fas fa-file-alt"></i> Descrição:</label>
                    <textarea id="descricaoPeriodo" name="descricao" rows="4" placeholder="Descreva a ocorrência que se repetiu no período..." required></textarea>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Salvar Período
                    </button>
                    <button type="button" class="btn btn-secondary close-btn-period">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
</div>

    <div id="occurrenceModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Ocorrências em DD/MM/AAAA</h3>
                <span class="close-btn">&times;</span>
            </div>

            <div class="modal-body">
                <div id="occurrenceListContainer">
                    <h4><i class="fas fa-list"></i> Ocorrências Registradas</h4>
                    <div id="occurrenceList">
                        <p id="noOccurrencesMessage">Nenhuma ocorrência registrada nesta data.</p>
                    </div>
                    <button id="openFormBtn" class="btn btn-primary btn-sm mt-3">
                        <i class="fas fa-plus"></i> Registrar Nova Ocorrência
                    </button>
                </div>

                <div id="occurrenceFormContainer" style="display: none;">
                    <h4><i class="fas fa-edit"></i> Detalhes da Ocorrência</h4>
                    <form id="occurrenceForm" th:action="@{/diario/salvar}" method="post" th:object="${ocorrencia}">
                        <input type="hidden" id="ocorrenciaId" th:field="*{id}">
                        <input type="hidden" id="ocorrenciaData" th:field="*{data}">


                        <div class="colaborador-account" style="display: flex; gap: 20px; align-items: flex-start;">
                            <div class="form-group">
                                <label for="colaboradorId"><i class="fas fa-user"></i> Colaborador:</label>
                                <select id="colaboradorId" th:field="*{colaborador.id}" class="select-filtro" required>
                                    <option value=""> Selecione um Colaborador </option>
                                    <option th:each="colab : ${colaboradores}" th:value="${colab.id}" th:text="${colab.nomeCompleto}"></option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="account"><i class="fas fa-user"></i> Account:</label>
                                <select id="account" name="account" class="select-filtro" required>
                                    <option value=""> Selecione uma Account </option>
                                    <option th:each="acc : ${accounts}" th:value="${acc}" th:text="${acc}"></option>
                                </select>
                            </div>
                        </div>

                        <div class="form-clockify" style="display: flex; align-items: flex-end; gap: 16px;">
                            <div class="form-group">
                                <label for="origemTipo"><i class="fas fa-building"></i> Origem:</label>
                                <select id="origemTipo" name="origem" class="select-filtro" required>
                                    <option value=""> Selecione a Origem </option>
                                    <option value="TimeTracker">TimeTracker</option>
                                    <option value="Clockify">Clockify</option>
                                </select>
                            </div>

                            <div class="form-group" id="clockifyClientesContainer" style="flex: 1; display: none;">
                                <label for="clockifyCliente"><i class="fas fa-building"></i> Cliente Clockify:</label>
                                <select id="clockifyCliente" th:field="*{clockifyCliente}" class="select-filtro">
                                    <option value=""> Selecione o Cliente </option>
                                    <option value="AB-InBev">AB-InBev</option>
                                    <option value="Cheesecake Labs">Cheesecake Labs</option>
                                    <option value="COAMO">COAMO</option>
                                    <option value="Contabilizei">Contabilizei</option>
                                    <option value="Credisis">Credisis</option>
                                    <option value="Grupo Potencial">Grupo Potencial</option>
                                    <option value="Iconic Hearts">Iconic Hearts</option>
                                    <option value="Philips">Philips</option>
                                    <option value="Serasa">Serasa</option>
                                    <option value="Sicoob SC/RS">Sicoob SC/RS</option>
                                    <option value="Studio Z">Studio Z</option>
                                    <option value="Tonic.ai">Tonic.ai</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="tipo"><i class="fas fa-tag"></i> Tipo:</label>
                            <select id="tipo" th:field="*{tipo}" class="select-filtro" required>
                                <option value=""> Selecione o Tipo </option>
                                <option  th:each="t : ${tipos}"
                                         th:value="${t}"
                                         th:text="${t.descricao}">></option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="status"><i class="fas fa-flag"></i> Status:</label>
                            <select id="status" th:field="*{status}" class="select-filtro" required>
                                <option value=""> Selecione o Status </option>
                                <option th:each="s : ${statusValues}" th:value="${s}" th:text="${s}"></option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="descricao"><i class="fas fa-file-alt"></i> Descrição:</label>
                            <textarea id="descricao" th:field="*{descricao}" rows="4" required></textarea>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Salvar Ocorrência
                            </button>
                            <button type="button" id="cancelFormBtn" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button type="button" id="deleteOcurrenceBtn" class="btn btn-danger" style="display: none;">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
</html>